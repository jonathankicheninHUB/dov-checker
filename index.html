<script>
    // --- CONFIGURATION DE VOTRE PROJET (À MODIFIER !) ---
    const COLLECTION_NAME = "dawnofvictory"; // Remplacez par le nom EXACT de votre collection WAX
    // ID du template de test : simule votre NFT "Tank HQ"
    // REMPLACER "000000" par un Template ID réel que vous possédez dans votre collection
    const TEMPLATE_ID_TEST = "871035"; 
    const WAX_ENDPOINT = 'https://wax.greymass.com'; 
    
    // --- Variables Globales ---
    // Initialisation de WAXJS directement ici, en dehors de tout événement, pour une disponibilité immédiate
    const wax = new waxjs.WaxJS({
        rpcEndpoint: WAX_ENDPOINT,
        tryAutoLogin: true 
    });
    
    let userAccount = null;

    // L'initialisation est appelée au chargement
    document.addEventListener('DOMContentLoaded', () => {
        initWax();
    });

    async function initWax() {
        if (await wax.isLoggedIn()) {
            userAccount = wax.userAccount;
            document.getElementById('wallet-status').innerText = `Connecté: ${userAccount}`;
            await checkAndApplyAssets(userAccount);
        }
    }

    // Fonction appelée par le bouton "Connecter"
    async function loginWax() {
        // La vérification ! Si wax n'est pas défini (bien que maintenant il le soit), on alerte.
        if (!wax) {
             alert("Erreur critique: WAXJS n'a pas pu s'initialiser.");
             return;
        }
        
        try {
            document.getElementById('asset-status').innerText = "Connexion en cours...";
            userAccount = await wax.login();
            document.getElementById('wallet-status').innerText = `Connecté: ${userAccount}`;
            await checkAndApplyAssets(userAccount);

        } catch (e) {
            console.error("Échec de la connexion WAX:", e);
            document.getElementById('wallet-status').innerText = "Statut: Échec de la connexion";
            document.getElementById('asset-status').innerText = "Veuillez autoriser la connexion dans la fenêtre WAX Wallet.";
        }
    }

    // Vérifie la possession du NFT Test
    async function checkNftPossession(walletAddress, templateId) {
        const API_URL = "https://wax.api.atomicassets.io/atomicassets/v1/assets";
        
        try {
            const response = await fetch(`${API_URL}?owner=${walletAddress}&collection_name=${COLLECTION_NAME}&template_id=${templateId}&limit=1&hide_offers=true`);
            const data = await response.json();
            
            // Retourne TRUE si des assets sont trouvés pour ce template ID
            return data.data && data.data.length > 0;
            
        } catch (error) {
            console.error("Erreur de vérification AtomicAssets:", error);
            document.getElementById('asset-status').innerText = "Erreur lors de la vérification des assets.";
            return false;
        }
    }

    // Gère le flux de vérification et applique la logique du jeu
    async function checkAndApplyAssets(account) {
        document.getElementById('asset-status').className = 'loading';
        document.getElementById('asset-status').innerText = "Chargement des actifs DOV en cours...";

        const hasTestNFT = await checkNftPossession(account, TEMPLATE_ID_TEST);

        if (hasTestNFT) {
            document.getElementById('asset-status').className = 'success';
            document.getElementById('asset-status').innerHTML = `
                ✅ **Félicitations, COMMANDANT !**
                <br>NFT ${TEMPLATE_ID_TEST} (Tank HQ) trouvé ! Accès aux unités premium débloqué !
            `;
            // --- Logique du jeu/simulateur : C'EST ICI QUE VOUS LANCEZ VOTRE JEU AVEC LES BONUS ---
        } else {
            document.getElementById('asset-status').className = 'failure';
            document.getElementById('asset-status').innerHTML = `
                ❌ **Actifs de Base :**
                <br>Le NFT ${TEMPLATE_ID_TEST} (Tank HQ) n'a pas été trouvé. Accès au simulateur standard.
            `;
        }
    }
</script>
